/*!
 *
 * jQuery TE 1.4.0 , http://jqueryte.com/
 * Copyright (C) 2013, Fatih Koca (fattih@fattih.com), (http://jqueryte.com/about)
 *
 * jQuery TE is provided under the MIT LICENSE.
 *
 * Updated by Taufik Nurrohman <https://github.com/tovic> @since 30 January 2016
 *
 */
!function(e){e.fn.jqte=function(t){function s(e,t,s,a,i){var n=d.length+1;return d.push({name:e,cls:n,command:t,key:s,tag:a,emphasis:i})}var a=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}],i=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]],n=["10","12","16","18","20","24","28"],o=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"],l=["Web Address","E-mail Address","Picture URL"],c=e.extend({status:!0,css:"jqte",title:!0,titletext:a,button:"OK",format:!0,formats:i,fsize:!0,fsizes:n,funit:"px",color:!0,linktypes:l,b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,left:!0,center:!0,right:!0,strike:!0,link:!0,unlink:!0,remove:!0,rule:!0,source:!0,placeholder:!1,br:!0,p:!0,change:"",focus:"",blur:""},t);e.fn.jqteVal=function(t){e(this).closest("."+c.css).find("."+c.css+"_editor").html(t)};var r=navigator.userAgent.toLowerCase();/msie [1-7]./.test(r)&&(c.title=!1);var d=[];return s("format","formats","","",!1),s("fsize","fSize","","",!1),s("color","colors","","",!1),s("b","Bold","B",["strong","b"],!0),s("i","Italic","I",["em","i"],!0),s("u","Underline","U",["u"],!0),s("ol","insertorderedlist","¾",["ol"],!0),s("ul","insertunorderedlist","¼",["ul"],!0),s("sub","subscript","(",["sub"],!0),s("sup","superscript","&",["sup"],!0),s("outdent","outdent","%",["blockquote"],!1),s("indent","indent","'",["blockquote"],!0),s("left","justifyLeft","","",!1),s("center","justifyCenter","","",!1),s("right","justifyRight","","",!1),s("strike","strikeThrough","K",["strike"],!0),s("link","linkcreator","L",["a"],!0),s("unlink","unlink","",["a"],!1),s("remove","removeformat",".","",!1),s("rule","inserthorizontalrule","H",["hr"],!1),s("source","displaysource","","",!1),this.each(function(){function t(){return window.getSelection?window.getSelection():document.selection&&document.selection.createRange&&"None"!=document.selection.type?document.selection.createRange():void 0}function s(e,s){var a,n=t();window.getSelection?(n.anchorNode&&n.getRangeAt&&(a=n.getRangeAt(0)),a&&(n.removeAllRanges(),n.addRange(a)),r.match(/msie/)||document.execCommand("StyleWithCSS",!1,!1),document.execCommand(e,!1,s)):document.selection&&document.selection.createRange&&"None"!=document.selection.type&&(a=document.selection.createRange(),a.execCommand(e,!1,s)),i(!1,!1)}function a(s,a,n){if(L.not(":focus")&&L.focus(),window.getSelection){var o,l,c,r=t();r.anchorNode&&r.getRangeAt&&(o=r.getRangeAt(0),l=document.createElement(s),e(l).attr(a,n),c=o.extractContents(),l.appendChild(c),o.insertNode(l),r.removeAllRanges(),"style"==a?i(e(l),n):i(e(l),!1))}else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type){var d=document.selection.createRange(),u=d.htmlText,f="<"+s+" "+a+'="'+n+'">'+u+"</"+s+">";document.selection.createRange().pasteHTML(f)}}function i(e,t){var s=tt();if(s=s?s:e,s&&0==t)s.parent().is("[style]")&&s.attr("style",s.parent().attr("style")),s.is("[style]")&&s.find("*").attr("style",s.attr("style"));else if(e&&t&&e.is("[style]")){var a=t.split(";");a=a[0].split(":"),e.is("[style*="+a[0]+"]")&&e.find("*").css(a[0],a[1]),n(e)}}function n(t){if(t){var t=t[0];if(document.body.createTextRange){var s=document.body.createTextRange();s.moveToElementText(t),s.select()}else if(window.getSelection){var a=window.getSelection(),s=document.createRange();"undefined"!=t&&null!=t&&(s.selectNodeContents(t),a.removeAllRanges(),a.addRange(s),e(t).is(":empty")&&(e(t).append("&nbsp;"),n(e(t))))}}}function l(){if(T.data("sourceOpened"))f(!1);else{var t=tt(),s="http://";if(f(!0),t){var i=t.prop("tagName").toLowerCase();"a"==i&&t.is("[href]")?(s=t.attr("href"),t.attr(D,"")):a("a",D,"")}else H.val(s).focus();q.click(function(t){(e(t.target).hasClass(c.css+"_linktypetext")||e(t.target).hasClass(c.css+"_linktypearrow"))&&h(!0)}),I.find("a").click(function(){var t=e(this).attr(c.css+"-linktype");I.data("linktype",t),U.find("."+c.css+"_linktypetext").html(I.find("a:eq("+I.data("linktype")+")").text()),m(s),h()}),m(s),H.focus().val(s).bind("keypress keyup",function(e){return 13==e.keyCode?(u(F.find("["+D+"]")),!1):void 0}),$.click(function(){u(F.find("["+D+"]"))})}}function u(t){H.focus(),n(t),t.removeAttr(D),"2"!=I.data("linktype")?s("createlink",H.val()):(s("insertImage",H.val()),L.find("img").each(function(){var t=e(this).prev("a"),s=e(this).next("a");t.length>0&&""==t.html()?t.remove():s.length>0&&""==s.html()&&s.remove()})),f(),L.trigger("change")}function f(e){g("["+D+"]:not([href])"),F.find("["+D+"][href]").removeAttr(D),e?(T.data("linkOpened",!0),O.show()):(T.data("linkOpened",!1),O.hide()),h()}function h(e){e?I.show():I.hide()}function m(e){var t=I.data("linktype");H.val("1"!=t||"http://"!=H.val()&&!H.is("[value^=http://]")&&H.is("[value^=mailto]")?"1"==t||H.is("[value^=http://]")?e:"http://":"mailto:")}function p(t){T.data("sourceOpened")?v(styleField,!1):("fSize"==t?styleField=Z:"colors"==t&&(styleField=et),v(styleField,!0),styleField.find("a").unbind("click").click(function(){var s=e(this).attr(c.css+"-styleval");"fSize"==t?(styleType="font-size",s+=c.funit):"colors"==t&&(styleType="color",s="rgb("+s+")");var i=y(styleType);a("span","style",styleType+":"+s+";"+i),v("",!1),e("."+c.css+"_title").remove(),L.trigger("change")})),f(!1)}function v(e,t){var s="",a=[{d:"fsizeOpened",f:Z},{d:"cpallOpened",f:et}];if(""!=e)for(var i=0;i<a.length;i++)e==a[i].f&&(s=a[i]);if(t){T.data(s.d,!0),s.f.show();for(var i=0;i<a.length;i++)s.d!=a[i].d&&(T.data(a[i].d,!1),a[i].f.hide())}else for(var i=0;i<a.length;i++)T.data(a[i].d,!1),a[i].f.hide()}function g(t){F.find(t).each(function(){e(this).before(e(this).html()).remove()})}function y(e){var t=tt();if(t&&t.is("[style]")&&""!=t.css(e)){var s=t.css(e);t.css(e,"");var a=t.attr("style");return t.css(e,s),a}return""}function _(){k(!0),Y.find("a").click(function(){e("*",this).click(function(e){return e.preventDefault(),!1}),b(e(this).text());var t=e(this).attr(c.css+"-formatval");s("formatBlock","<"+t+">"),k(!1)})}function k(e){var t=e?!0:!1;t=e&&Y.data("status")?!0:!1,t||!e?Y.data("status",!1).hide():Y.data("status",!0).show()}function b(e){var t=Y.closest("."+c.css+"_tool").find("."+c.css+"_tool_label").find("."+c.css+"_tool_text");e.length>10&&(e=e.substr(0,7)+"..."),t.html(e)}function C(e){var t,s,a;for(t=e.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/&nbsp;/gim," "),s=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<b(|\s+.*?)>(.*?)\<\/b>/gim,/\<i(|\s+.*?)>(.*?)\<\/i>/gim],a=["<span$2>$3</span>","","<p$1>$2</p>","<strong$1>$2</strong>","<em$1>$2</em>"],P=0;5>P;P++)for(var i=0;i<s.length;i++)t=t.replace(s[i],a[i]);if(c.p||(t=t.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/gi,"<br/>$2")),!c.br){s=[/\<br>(.*?)/gi,/\<br\/>(.*?)/gi],a=["<p>$1</p>","<p>$1</p>"];for(var i=0;i<s.length;i++)t=t.replace(s[i],a[i])}return c.p||c.br||(t=t.replace(/\<p>(.*?)\<\/p>/gi,"<div>$1</div>")),t}function w(){var e=""==L.text()&&L.html().length<12?"":L.html();z.val(C(e))}function x(){L.html(C(z.val()))}function R(t){var s,a=!1,i=tt();return i?(e.each(t,function(t,n){s=i.prop("tagName").toLowerCase(),s==n?a=!0:i.parents().each(function(){s=e(this).prop("tagName").toLowerCase(),s==n&&(a=!0)})}),a):!1}function A(){for(var t=0;t<d.length;t++)c[d[t].name]&&d[t].emphasis&&""!=d[t].tag&&(R(d[t].tag)?T.find("."+c.css+"_tool_"+d[t].cls).addClass(j):e("."+c.css+"_tool_"+d[t].cls).removeClass(j));if(c.format&&e.isArray(c.formats)){for(var s=!1,a=0;a<c.formats.length;a++){var i=[];if(i[0]=c.formats[a][0],c.formats[a][0].length>0&&R(i)){b(c.formats[a][1]),s=!0;break}}s||b(c.formats[0][1])}v("",!1),k(!1)}if(e(this).data("jqte")&&null!=e(this).data("jqte")&&"undefined"!=e(this).data("jqte")?e(this).data("jqte",!1):e(this).data("jqte",!0),c.status&&e(this).data("jqte")){var z=e(this),S=e(this).prop("tagName").toLowerCase();e(this).attr("data-origin",S);var N=e(this).is("[value]")||"textarea"==S?e(this).val():e(this).html();N=N.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),e(this).after('<div class="'+c.css+'"></div>');var F=e(this).next("."+c.css);F.html('<div class="'+c.css+'_toolbar" role="toolbar" unselectable></div><div class="'+c.css+'_linkform" style="display:none" role="dialog"></div><div class="'+c.css+'_editor"></div>');var T=F.find("."+c.css+"_toolbar"),O=F.find("."+c.css+"_linkform"),L=F.find("."+c.css+"_editor"),j=c.css+"_tool_depressed";O.append('<div class="'+c.css+'_linktypeselect" unselectable></div><input class="'+c.css+'_linkinput" type="text/css" value=""><div class="'+c.css+'_linkbutton" unselectable>'+c.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var q=O.find("."+c.css+"_linktypeselect"),H=O.find("."+c.css+"_linkinput"),$=O.find("."+c.css+"_linkbutton");q.append('<div class="'+c.css+'_linktypeview" unselectable></div><div class="'+c.css+'_linktypes" role="menu" unselectable></div>');var I=q.find("."+c.css+"_linktypes"),U=q.find("."+c.css+"_linktypeview"),D=c.css+"-setlink";L.after('<div class="'+c.css+"_source "+c.css+'_hiddenField"></div>');var W=F.find("."+c.css+"_source");if(z.appendTo(W),"textarea"!=S){var E="";e(z[0].attributes).each(function(){"type"!=this.nodeName&&"value"!=this.nodeName&&(E=E+" "+this.nodeName+'="'+this.nodeValue+'"')}),z.replaceWith("<textarea "+E+">"+N+"</textarea>"),z=W.find("textarea")}L.attr("contenteditable","true").html(N);for(var M=0;M<d.length;M++)if(c[d[M].name]){var B=d[M].key.length>0&&null!=c.titletext[M].hotkey&&"undefined"!=c.titletext[M].hotkey&&""!=c.titletext[M].hotkey?" (Ctrl+"+c.titletext[M].hotkey+")":"",K=null!=c.titletext[M].title&&"undefined"!=c.titletext[M].title&&""!=c.titletext[M].title?c.titletext[M].title+B:"";if(T.append('<div class="'+c.css+"_tool "+c.css+"_tool_"+d[M].cls+'" role="button" data-tool="'+M+'" unselectable><a class="'+c.css+'_tool_icon" unselectable></a></div>'),T.find("."+c.css+"_tool[data-tool="+M+"]").data({tag:d[M].tag,command:d[M].command,emphasis:d[M].emphasis,title:K}),"format"==d[M].name&&e.isArray(c.formats)){var J=c.formats[0][1].length>0&&"undefined"!=c.formats[0][1]?c.formats[0][1]:"";T.find("."+c.css+"_tool_"+d[M].cls).find("."+c.css+"_tool_icon").replaceWith('<a class="'+c.css+'_tool_label" unselectable><span class="'+c.css+'_tool_text" unselectable>'+J+'</span><span class="'+c.css+'_tool_icon" unselectable></span></a>'),T.find("."+c.css+"_tool_"+d[M].cls).append('<div class="'+c.css+'_formats" unselectable></div>');for(var V=0;V<c.formats.length;V++)T.find("."+c.css+"_formats").append("<a "+c.css+'-formatval="'+c.formats[V][0]+'" class="'+c.css+"_format "+c.css+"_format_"+V+'" role="menuitem" unselectable>'+c.formats[V][1]+"</a>");T.find("."+c.css+"_formats").data("status",!1)}else if("fsize"==d[M].name&&e.isArray(c.fsizes)){T.find("."+c.css+"_tool_"+d[M].cls).append('<div class="'+c.css+'_fontsizes" unselectable></div>');for(var V=0;V<c.fsizes.length;V++)T.find("."+c.css+"_fontsizes").append("<a "+c.css+'-styleval="'+c.fsizes[V]+'" class="'+c.css+'_fontsize" style="font-size:'+c.fsizes[V]+c.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}else if("color"==d[M].name&&e.isArray(o)){T.find("."+c.css+"_tool_"+d[M].cls).append('<div class="'+c.css+'_cpalette" unselectable></div>');for(var P=0;P<o.length;P++)T.find("."+c.css+"_cpalette").append(null!=o[P]?"<a "+c.css+'-styleval="'+o[P]+'" class="'+c.css+'_color" style="background-color: rgb('+o[P]+')" role="gridcell" unselectable></a>':'<div class="'+c.css+'_colorSeperator"></div>')}}I.data("linktype","0");for(var M=0;3>M;M++)I.append("<a "+c.css+'-linktype="'+M+'" unselectable>'+c.linktypes[M]+"</a>"),U.html('<div class="'+c.css+'_linktypearrow" unselectable></div><div class="'+c.css+'_linktypetext">'+I.find("a:eq("+I.data("linktype")+")").text()+"</div>");var G="";if(G=/msie/.test(r)?"-ms-":/chrome/.test(r)||/safari/.test(r)||/yandex/.test(r)?"-webkit-":/mozilla/.test(r)?"-moz-":/opera/.test(r)?"-o-":/konqueror/.test(r)?"-khtml-":"",c.placeholder&&""!=c.placeholder){F.prepend('<div class="'+c.css+'_placeholder" unselectable><div class="'+c.css+'_placeholder_text">'+c.placeholder+"</div></div>");var Q=F.find("."+c.css+"_placeholder");Q.click(function(){L.focus()})}F.find("[unselectable]").css(G+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",!1);var X=T.find("."+c.css+"_tool"),Y=T.find("."+c.css+"_formats"),Z=T.find("."+c.css+"_fontsizes"),et=T.find("."+c.css+"_cpalette"),tt=function(){var t,s;if(window.getSelection&&(s=getSelection(),t=s.anchorNode),!t&&document.selection&&document.selection.createRange&&"None"!=document.selection.type){s=document.selection;var a=s.getRangeAt?s.getRangeAt(0):s.createRange();t=a.commonAncestorContainer?a.commonAncestorContainer:a.parentElement?a.parentElement():a.item(0)}return t?e("#text"==t.nodeName?t.parentNode:t):!1};X.unbind("click").click(function(t){"displaysource"!=e(this).data("command")||T.data("sourceOpened")?(T.data("sourceOpened")?(T.data("sourceOpened",!1),T.find("."+c.css+"_tool").removeClass(c.css+"_hiddenField"),W.addClass(c.css+"_hiddenField"),L.removeClass(c.css+"_hiddenField")):"linkcreator"==e(this).data("command")?T.data("linkOpened")?(f(!1),k(!1)):l():"formats"==e(this).data("command")?("formats"!=e(this).data("command")||e(t.target).hasClass(c.css+"_format")||_(),v("",!1),L.not(":focus")&&L.focus()):"fSize"==e(this).data("command")||"colors"==e(this).data("command")?(("fSize"==e(this).data("command")&&!e(t.target).hasClass(c.css+"_fontsize")||"colors"==e(this).data("command")&&!e(t.target).hasClass(c.css+"_color"))&&p(e(this).data("command")),k(!1),L.not(":focus")&&L.focus()):(L.not(":focus")&&L.focus(),s(e(this).data("command"),null),v("",!1),k(!1),h(),1!=e(this).data("emphasis")||e(this).hasClass(j)?e(this).removeClass(j):e(this).addClass(j),W.addClass(c.css+"_hiddenField"),L.removeClass(c.css+"_hiddenField")),c.placeholder&&""!=c.placeholder&&(""!=L.html()?Q.hide():Q.show())):(T.find("."+c.css+"_tool").addClass(c.css+"_hiddenField"),e(this).removeClass(c.css+"_hiddenField"),T.data("sourceOpened",!0),z.css("height",L.outerHeight()),W.removeClass(c.css+"_hiddenField"),L.addClass(c.css+"_hiddenField"),z.focus(),f(!1),v("",!1),k(),c.placeholder&&""!=c.placeholder&&Q.hide()),L.trigger("change")}).hover(function(t){if(c.title&&""!=e(this).data("title")&&(e(t.target).hasClass(c.css+"_tool")||e(t.target).hasClass(c.css+"_tool_icon"))){e("."+c.css+"_title").remove(),F.append('<div class="'+c.css+'_title"><div class="'+c.css+'_titleArrow"><div class="'+c.css+'_titleArrowIcon"></div></div><div class="'+c.css+'_titleText">'+e(this).data("title")+"</div></div>");var s=e("."+c.css+"_title:first"),a=(s.find("."+c.css+"_titleArrowIcon"),e(this).position()),i=a.left+e(this).outerWidth()-s.outerWidth()/2-e(this).outerWidth()/2,n=a.top+e(this).outerHeight()+5;s.delay(400).css({top:n,left:i}).fadeIn(200)}},function(){e("."+c.css+"_title").remove()});var st=null;L.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){T.data("sourceOpened")||e(this).trigger("change"),h(),e.isFunction(c.change)&&c.change(),c.placeholder&&""!=c.placeholder&&(""!=e(this).text()?Q.hide():Q.show())}).bind("change",function(){T.data("sourceOpened")||(clearTimeout(st),st=setTimeout(w,10))}).keydown(function(e){if(e.ctrlKey)for(var t=0;t<d.length;t++)if(c[d[t].name]&&e.keyCode==d[t].key.charCodeAt(0))return""!=d[t].command&&"linkcreator"!=d[t].command?s(d[t].command,null):"linkcreator"==d[t].command&&l(),!1}).bind("mouseup keyup",A).focus(function(){if(e.isFunction(c.focus)&&c.focus(),F.addClass(c.css+"_focused"),/opera/.test(r)){var t=document.createRange();t.selectNodeContents(L[0]),t.collapse(!1);var s=window.getSelection();s.removeAllRanges(),s.addRange(t)}}).focusout(function(){X.removeClass(j),v("",!1),k(!1),h(),e.isFunction(c.blur)&&c.blur(),F.removeClass(c.css+"_focused"),e.isArray(c.formats)&&b(c.formats[0][1])}),z.bind("keydown keyup",function(){setTimeout(x,0),e(this).height(e(this)[0].scrollHeight),""==e(this).val()&&e(this).height(0)}).focus(function(){F.addClass(c.css+"_focused")}).focusout(function(){F.removeClass(c.css+"_focused")})}else if(e(this).closest("."+c.css).length>0){var at=e(this).closest("."+c.css).find("."+c.css+"_editor").html(),E="";e(e(this)[0].attributes).each(function(){"style"!=this.nodeName&&(E=E+" "+this.nodeName+'="'+this.nodeValue+'"')});var S=e(this).is("[data-origin]")&&""!=e(this).attr("data-origin")?e(this).attr("data-origin"):"textarea",it=">"+at;("input"==S||"option"==S)&&(at=at.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),it='value="'+at+'">');var nt=e(this).clone();e(this).data("jqte",!1).closest("."+c.css).before(nt).remove(),nt.replaceWith("<"+S+E+it+"</"+S+">")}})}}(jQuery);